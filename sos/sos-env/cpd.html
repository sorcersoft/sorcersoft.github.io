<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at May 18, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20130518" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                SORCER OS :: env
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2013-05-18</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="./" title="SORCER OS :: env">SORCER OS :: env</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="SORCER OS">SORCER OS</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                                                                <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                    <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.0.2.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>sorcer/util/GenericUtil.java</td><td><a href="./xref/sorcer/util/GenericUtil.html#2329">2329</a></td></tr><tr class="a"><td>sorcer/util/GenericUtil.java</td><td><a href="./xref/sorcer/util/GenericUtil.html#2611">2611</a></td></tr><tr class="b"><td colspan='2'><div><pre>	public static int runShellScriptViaSlurm(String appName, File scriptFile,
			Vector&lt;String&gt; scriptRecords, File logFile, long scriptTimeout)
			throws Exception {

		logger.info(&quot;GenericUtil.runShellScriptViaSlurm():&quot;
				+ &quot;\n\tappName = + appName&quot; + &quot;\n\tscriptFile = &quot;
				+ scriptFile.getAbsolutePath());

		GenericUtil.setFileContents(scriptFile, scriptRecords);
		GenericUtil.makeExecutable(scriptFile);

		File scratchDir = scriptFile.getParentFile();

		String uid = null;
		String jobName = null;
		synchronized (GenericUtil.class) {
			// uid = UUID.randomUUID().toString();
			uid = Integer.toString(slurmSubmitCtr++);
			jobName = &quot;s&quot; + appName + &quot;_&quot; + uid;
			jobName = jobName.substring(0, Math.min(19, jobName.length() - 1));
		}

		// middle_.sh calls the script passed in by user in background, then
		// slurm script calls middle_.sh; slurm script kills middle_.sh if
		// user timeout option expires
		//
		// add semaphore: drop file to signal slurm job done
		//
		File middleScriptFile = new File(scratchDir, &quot;middle_&quot; + uid + &quot;.sh&quot;);
		File middleScriptLogFile = new File(scratchDir, &quot;middleLog_&quot; + uid
				+ &quot;.txt&quot;);
		File middleScriptErrFile = new File(scratchDir, &quot;middleErr_&quot; + uid
				+ &quot;.txt&quot;);
		File middleScriptDoneFile = new File(scratchDir, &quot;middleDone_&quot; + uid
				+ &quot;.txt&quot;);
		File middleScriptRunningFile = new File(scratchDir, &quot;middleRunning_&quot;
				+ uid + &quot;.txt&quot;);
		File middleScriptKilledFile = new File(scratchDir, &quot;middleKilled_&quot;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>sorcer/util/GenericUtil.java</td><td><a href="./xref/sorcer/util/GenericUtil.html#1076">1076</a></td></tr><tr class="a"><td>sorcer/util/GenericUtil.java</td><td><a href="./xref/sorcer/util/GenericUtil.html#1167">1167</a></td></tr><tr class="b"><td colspan='2'><div><pre>		File shellFile = new File(directory, &quot;SAB.sh&quot;);
		GenericUtil.setFileContents(shellFile, shellScript);
		GenericUtil.makeExecutable(shellFile);

		// build remote shell argument
		//
		String remshCmd = &quot;remsh &quot; + machineName + &quot; -n 'cd &quot; + tildePath
				+ &quot;; SAB.sh'&quot;;
		//
		// build script to invoke remsh (stupid java)
		//
		Vector&lt;String&gt; remshV = new Vector&lt;String&gt;();
		remshV.add(remshCmd);
		File remshFile = new File(fullPath + &quot;/SAB.remsh&quot;);

		GenericUtil.setFileContents(remshFile, remshV);
		GenericUtil.makeExecutable(remshFile);

		// run script on remote machine
		//
		Runtime rt = Runtime.getRuntime();
		String[] temp = { &quot;csh&quot;, &quot;-f&quot;, &quot;-c&quot;, fullPath + &quot;/SAB.remsh&quot; };
		Process proc = rt.exec(temp);

		String line;
		BufferedReader is = new BufferedReader(new InputStreamReader(
				proc.getInputStream()));
		while ((line = is.readLine()) != null) {
			System.out.println(&quot;GenericUtil: runRemoteShellScript: &quot;
					+ &quot;Stream from remsh :&quot; + line);
		}
		proc.waitFor();</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>sorcer/util/GenericUtil.java</td><td><a href="./xref/sorcer/util/GenericUtil.html#2557">2557</a></td></tr><tr class="a"><td>sorcer/util/GenericUtil.java</td><td><a href="./xref/sorcer/util/GenericUtil.html#2936">2936</a></td></tr><tr class="b"><td colspan='2'><div><pre>				Thread.sleep(100);
				// }
			}
			if (exitValue != 0) {
				String msg = &quot;***error: had problem submitting &quot;
						+ &quot;slurm script:&quot; + &quot;\n\texit code = &quot; + exitValue
						+ &quot;\n\tscratchDir = &quot; + scratchDir + &quot;\n\ttries = &quot;
						+ tries + &quot;\n\tslurmScriptFile = &quot;
						+ slurmScriptFile.getAbsolutePath();
				logger.info(msg);
				logger.warning(msg);
				throw new Exception(msg);
			}

			Vector&lt;String&gt; srunCmdLogContents = GenericUtil
					.getFileContents(srunCmdJobIdFile);
			String jobID = srunCmdLogContents.get(0);
			logger.info(&quot;GenericUtil.runShellScriptViaSlurm(): jobID = &quot;
					+ jobID);

			// wait until slurm job is done (if -b option is used, this is
			// necessary)
			//
			// boolean isDone = middleScriptDoneFile.canRead();
			boolean isDone = slurmDoneFile.canRead();
			while (!isDone) {
				Thread.sleep(1000);
				isDone = slurmDoneFile.canRead();
				// isDone = middleScriptDoneFile.canRead();
			}
			// if (!isDone) {
			// String msg = &quot;***error: had problem with slurm script; the file &quot;
			// + middleScriptDoneFile.getAbsolutePath()
			// + &quot; was not generated fast enough: &quot;
			// + &quot;\n\tscratchDir = &quot; + scratchDir
			// + &quot;\n\tslurmScriptFile = &quot; + slurmScriptFile.getAbsolutePath()
			// + &quot;\n\ttries = &quot; + tries
			// + &quot;\n\tisDone = &quot; + isDone
			// + &quot;\n\tcanRead() = &quot; + middleScriptDoneFile.canRead()
			// + &quot;\n\texists() = &quot; + middleScriptDoneFile.exists();
			// logger.info(msg);
			// logger.warning(msg);
			// throw new Exception(msg);
			// }
		} catch (Exception ioe) {
			ioe.printStackTrace();
		}
		logger.info(&quot;GenericUtil.runShellScriptViaSlurm(): exitValue = &quot;
				+ exitValue);

		return exitValue;
	}

	// scriptTimeout = 0 is infinity
	public static int runShellScriptViaSlurm3(String appName, File scriptFile,</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2013.
          All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
